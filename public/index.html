<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
   <title>Bauer Family Photo Gallery</title>

   <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
   <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery.colorbox/1.6.4/jquery.colorbox-min.js"></script>

   <style type="text/css">
      body{ color: #fff; background-color: #000; font: 13px 'Lucida Grande', Verdana, sans-serif;}
      html,body{ margin:0; padding:0; height:100%; border:none;overflow:hidden;}

      .scale1 {width: 98px;height: 98px;}
      .scale2 {width:198px;height:198px;}
      .scale3 {width:298px;height:298px;}

      label {display:inline-block;}

      #container .column {float:left;}
      #center {position:relative; width:100%; height:100%; overflow:auto;}
      .picDiv {border:1px solid #fff;
           -webkit-border-radius: 20px;
           -moz-border-radius: 20px;
           border-radius: 20px;
          }
   </style>

<SCRIPT language="JavaScript">

    var saveTimer = null;

$(document).ready(function() {
   $(':input').keydown(function() {
      if (saveTimer)
         clearTimeout(saveTimer);
      saveTimer = setTimeout(function() {saveChanges();},3000);
   });

   $.get('/api/getconfig',{buildcats: 1},function (data) {
      $("#delay").val(data.delay);
      $("#imageCategories").html(data.onlyTheseTags.join());
     
      loadCategories(data.onlyTheseTags);
   }, "json");

});

function changeTag() {
   var i;
   var Names="";
   var tags = [];

   for (i=0;i < 1000;i++) {
      var checkName = "checkBox" + i;
      var checkCtrl = document.getElementById(checkName);

      if (checkCtrl == null)
         break;

      if (checkCtrl.checked) {
         var v = checkCtrl.value;

         if (v) {
            if (Names != "")
               Names += ", ";
            Names += v;

            tags.push(v);
         }
      }
   }

   saveChanges(tags);   

   document.getElementById("categories").innerHTML = "<b>Categories:</b> " + Names;

}

function saveChanges(tags) {
   saveTimer = null;
   $.get('/api/setconfig',{
      delay: $("#delay").val(),
      onlyTheseTags: tags
   },function (data) {
      console.log("Save finished:",data);
   });
}

function loadCategories(imageCategories) {
   $.get('/api/getcategories',{buildcats: 1},function (data) {
      var lastParent = "";
      var listCode = "";

      for (i = 0;i < data.length;i++) {
         if (data[i].parent != lastParent) {
            lastParent = data[i].parent;
            listCode += "<br><span style=\"color:green\"><b>" + lastParent + "</b></span>" + "<br>";
         }
         let checked = "";
         for (let c = 0;c < imageCategories.length;c ++) {
            if (data[i].name == imageCategories[c])
               checked = "checked";
         }

         listCode += "<label><input type=\"checkbox\" value=\"" + data[i].name + "\" id=\"checkBox" + i + "\" onClick=\"changeTag();\" " + checked+">" + htmlSafe(data[i].name) + "</label>";
      }

      document.getElementById("tagsDiv").innerHTML=listCode;
   }, "json");
}

function htmlSafe(str) {
    return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g,'&#39;');
}

</SCRIPT>

</head>
<body>
 <div id="container">
   <div>
      <form>
        <fieldset>
          Delay between images: <input id="delay" type="text" maxlength="2" size="2" /><br/>
          <div id="categories"><b>Categories:&nbsp;</b><label id="imageCategories"></label></div>
        </fieldset>
      </form>
   </div>
   <div>
     <div id="tagsDiv"></div>
   </div>
 </div>
</body>
</html>

